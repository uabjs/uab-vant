import{y as K,z as M,l as X,e as H,w as V,a as j,i as G}from"./use-translate-39e9697c.js";import{n as A,t as w,u as U,m as S,c as $,w as q}from"./index-594801ee.js";import{y as d,I as B,S as W,u as _,A as Z,C as J,q as Q,N as ee,O as oe,M as te,e as O,V as ne,F as ae,D as E,T as se,j as le,v as ce}from"./vue-libs-cca96e89.js";import{T as D,H as re}from"./constant-a3e7c845.js";import{u as ie,O as ue}from"./index-3e5dcb68.js";import{c as de}from"./interceptor-771d0e71.js";import{u as fe}from"./use-global-z-index-2c1217af.js";import{u as z}from"./use-scope-id-f139dbfe.js";import{u as ve}from"./use-expose-50370a66.js";const me={show:Boolean,zIndex:A,overlay:w,duration:A,teleport:[String,Object],lockScroll:w,lazyRender:w,beforeClose:Function,overlayStyle:Object,overlayClass:U,transitionAppear:Boolean,closeOnClickOverlay:w},he=Symbol();function ye(e,o){return e>o?"horizontal":o>e?"vertical":""}function Ie(){const e=d(0),o=d(0),s=d(0),r=d(0),t=d(0),a=d(0),l=d(""),c=d(!0),C=()=>l.value==="vertical",I=()=>l.value==="horizontal",i=()=>{s.value=0,r.value=0,t.value=0,a.value=0,l.value="",c.value=!0};return{move:u=>{const v=u.touches[0];s.value=(v.clientX<0?0:v.clientX)-e.value,r.value=v.clientY-o.value,t.value=Math.abs(s.value),a.value=Math.abs(r.value);const y=10;(!l.value||t.value<y&&a.value<y)&&(l.value=ye(t.value,a.value)),c.value&&(t.value>D||a.value>D)&&(c.value=!1)},start:u=>{i(),e.value=u.touches[0].clientX,o.value=u.touches[0].clientY},reset:i,startX:e,startY:o,deltaX:s,deltaY:r,offsetX:t,offsetY:a,direction:l,isVertical:C,isHorizontal:I,isTap:c}}let P=0;const g="van-overflow-hidden";function Oe(e,o){const s=Ie(),r="01",t="10",a=i=>{s.move(i);const h=s.deltaY.value>0?t:r,p=M(i.target,e.value),{scrollHeight:u,offsetHeight:v,scrollTop:y}=p;let m="11";y===0?m=v>=u?"00":"01":y+v>=u&&(m="10"),m!=="11"&&s.isVertical()&&!(parseInt(m,2)&parseInt(h,2))&&X(i,!0)},l=()=>{document.addEventListener("touchstart",s.start),document.addEventListener("touchmove",a,{passive:!1}),P||document.body.classList.add(g),P++},c=()=>{P&&(document.removeEventListener("touchstart",s.start),document.removeEventListener("touchmove",a),P--,P||document.body.classList.remove(g))},C=()=>o()&&l(),I=()=>o()&&c();K(C),B(I),W(I),_(o,i=>{i?l():c()})}const Ce=H({},me,{round:Boolean,position:S("center"),closeIcon:S("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:S("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Pe,L]=j("popup"),pe=Z({name:Pe,inheritAttrs:!1,props:Ce,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:s,slots:r}){let t,a;const l=d(),c=d(),C=ie(()=>e.show||!e.lazyRender),I=J(()=>{const n={zIndex:l.value};if(G(e.duration)){const f=e.position==="center"?"animationDuration":"transitionDuration";n[f]=`${e.duration}s`}return n}),i=()=>{t||(t=!0,l.value=e.zIndex!==void 0?+e.zIndex:fe(),o("open"))},h=()=>{t&&de(e.beforeClose,{done(){t=!1,o("close"),o("update:show",!1)}})},p=n=>{o("clickOverlay",n),e.closeOnClickOverlay&&h()},u=()=>{if(e.overlay)return O(ue,E({show:e.show,class:e.overlayClass,zIndex:l.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},z(),{onClick:p}),{default:r["overlay-content"]})},v=n=>{o("clickCloseIcon",n),h()},y=()=>{if(e.closeable)return O($,{role:"button",tabindex:0,name:e.closeIcon,class:[L("close-icon",e.closeIconPosition),re],classPrefix:e.iconPrefix,onClick:v},null)};let m;const R=()=>{m&&clearTimeout(m),m=setTimeout(()=>{o("opened")})},N=()=>o("closed"),Y=n=>o("keydown",n),F=C(()=>{var x;const{round:n,position:f,safeAreaInsetTop:k,safeAreaInsetBottom:T}=e;return le(O("div",E({ref:c,style:I.value,role:"dialog",tabindex:0,class:[L({round:n,[f]:f}),{"van-safe-area-top":k,"van-safe-area-bottom":T}],onKeydown:Y},s,z()),[(x=r.default)==null?void 0:x.call(r),y()]),[[ce,e.show]])}),b=()=>{const{position:n,transition:f,transitionAppear:k}=e,T=n==="center"?"van-fade":`van-popup-slide-${n}`;return O(se,{name:f||T,appear:k,onAfterEnter:R,onAfterLeave:N},{default:F})};return _(()=>e.show,n=>{n&&!t&&(i(),s.tabindex===0&&Q(()=>{var f;(f=c.value)==null||f.focus()})),!n&&t&&(t=!1,o("close"))}),ve({popupRef:c}),Oe(c,()=>e.show&&e.lockScroll),V("popstate",()=>{e.closeOnPopstate&&(h(),a=!1)}),ee(()=>{e.show&&i()}),oe(()=>{a&&(o("update:show",!0),a=!1)}),B(()=>{e.show&&e.teleport&&(h(),a=!0)}),te(he,()=>e.show),()=>e.teleport?O(ne,{to:e.teleport},{default:()=>[u(),b()]}):O(ae,null,[u(),b()])}}),ze=q(pe);export{ze as P};
