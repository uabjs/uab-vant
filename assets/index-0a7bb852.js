import{m as q,n as O,e as W,h as k,a as K,i as h,C as Y,t as S,l as j}from"./use-translate-39e9697c.js";import{m as E,n as F,u as J,d as U,w as z}from"./index-594801ee.js";import{c as G,C as H}from"./Cell-4dc9c92e.js";import{F as Q}from"./constant-a3e7c845.js";import{u as X}from"./use-expose-50370a66.js";import{L as Z,A as ee,E as te,y as A,C as ne,M as ae,u as re,e as c,D as se}from"./vue-libs-cca96e89.js";let ie=0;function le(){const e=Z(),{name:n="unknown"}=(e==null?void 0:e.type)||{};return`${n}-${++ie}`}function T(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function oe(e,n){if(T(e)){if(n.required)return!1;if(n.validateEmpty===!1)return!0}return!(n.pattern&&!n.pattern.test(String(e)))}function ue(e,n){return new Promise(i=>{const f=n.validator(e,n);if(q(f)){f.then(i);return}i(f)})}function I(e,n){const{message:i}=n;return O(i)?i(e,n):i||""}function de(e){return e==="number"?{type:"text",inputmode:"decimal"}:e==="digit"?{type:"tel",inputmode:"numeric"}:{type:e}}function ce(e){return[...e].length}function fe(e,n){return[...e].slice(0,n).join("")}const[ge,g]=K("field"),me={id:String,name:String,maxlength:F,formatter:Function,modelValue:U(""),placeholder:String,errorMessage:String,formatTrigger:E("onChange")},pe=W({},G,me,{type:E("text"),rules:Array,labelWidth:F,labelClass:J,labelAlign:String,colon:{type:Boolean,default:null}}),he=ee({name:ge,props:pe,emits:["blur","endValidate","startValidate","update:modelValue"],setup(e,{emit:n,slots:i}){const f=le(),b=()=>e.id||`${f}-input`,r=te({status:"unvalidated",focused:!1,validateMessage:""}),V=A(),m=A(),{parent:o}=k(Q),w=()=>String(e.modelValue??""),u=t=>{if(h(e[t]))return e[t];if(o&&h(o.props[t]))return o.props[t]},M=ne(()=>m.value&&i.input?m.value():e.modelValue),x=t=>t.reduce((a,s)=>a.then(()=>{if(r.status==="failed")return;let{value:l}=M;if(s.formatter&&(l=s.formatter(l,s)),!oe(l,s)){r.status="failed",r.validateMessage=I(l,s);return}if(s.validator)return T(l)&&s.validateEmpty===!1?void 0:ue(l,s).then(d=>{d&&typeof d=="string"?(r.status="failed",r.validateMessage=d):d===!1&&(r.status="failed",r.validateMessage=I(l,s))})}),Promise.resolve()),p=()=>{r.status="unvalidated",r.validateMessage=""},v=()=>{n("endValidate",{status:r.status,message:r.validateMessage})},C=(t=e.rules)=>new Promise(a=>{p(),t?(n("startValidate"),x(t).then(()=>{r.status==="failed"?(a({name:e.name,message:r.validateMessage}),v()):(r.status="passed",a(),v())})):a()}),y=t=>{if(o&&e.rules){const{validateTrigger:a}=o.props,s=S(a).includes(t),l=e.rules.filter(d=>d.trigger?S(d.trigger).includes(t):s);l.length&&C(l)}},L=()=>{var t;return(t=V.value)==null?void 0:t.focus()},R=()=>{if(o&&o.props.showErrorMessage===!1)return;const t=e.errorMessage||r.validateMessage;if(t){const a=i["error-message"],s=u("errorMessageAlign");return c("div",{class:g("error-message",s)},[a?a({message:t}):t])}},B=()=>{u("labelWidth"),u("labelAlign");const t=u("colon")?":":"";if(i.label)return[i.label(),t];if(e.label)return c("label",{id:`${f}-label`,for:i.input?void 0:b(),onClick:a=>{j(a),L()}},[e.label+t])},P=(t,a="onChange")=>{if(e.formatter&&a===e.formatTrigger){const{formatter:s,maxlength:l}=e;t=s(t),h(l)&&ce(t)>+l&&(t=fe(t,+l))}t!==e.modelValue&&n("update:modelValue",t)},N=t=>{t.target.composing||P(t.target.value)},_=t=>{r.focused=!1,P(w(),"onBlur"),n("blur",t),!u("readonly")&&y("onBlur")},D=()=>{const t=g("control",[u("inputAlign")]);if(i.input)return c("div",{class:t},[i.input()]);const a={id:b(),ref:V,name:e.name,class:t,placeholder:e.placeholder,onBlur:_,onInput:N};return c("input",se(de(e.type),a),null)},$=()=>[c("div",{class:g("body")},[D()]),R()];return X({validate:C,formValue:M}),ae(Y,{customValue:m,resetValidation:p,validateWithTrigger:y}),re(()=>e.modelValue,()=>{p()}),()=>{const t=u("labelAlign"),a=()=>B()||[];return c("div",null,[c(H,{valueClass:g("value"),titleClass:[g("label",[t,{required:e.required}]),e.labelClass]},{title:a,value:$})])}}}),Pe=z(he);export{Pe as F};
